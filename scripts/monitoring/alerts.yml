# Prometheus Alert Rules for BofhContract V2
# Place this file in your Prometheus configuration directory

groups:
  - name: bofhcontract_alerts
    interval: 30s
    rules:
      # Gas Usage Alerts
      - alert: HighGasUsage
        expr: bofh_gas_used > 300000
        for: 2m
        labels:
          severity: warning
          component: gas
        annotations:
          summary: "High gas usage detected"
          description: "Gas usage ({{ $value }}) exceeded threshold of 300,000 gas"

      - alert: ExtremeGasUsage
        expr: bofh_gas_used > 400000
        for: 1m
        labels:
          severity: critical
          component: gas
        annotations:
          summary: "Extreme gas usage detected"
          description: "Gas usage ({{ $value }}) exceeded critical threshold of 400,000 gas"

      # Success Rate Alerts
      - alert: LowSuccessRate
        expr: (bofh_successful_swaps / bofh_total_swaps) < 0.95
        for: 5m
        labels:
          severity: warning
          component: reliability
        annotations:
          summary: "Low swap success rate"
          description: "Success rate ({{ $value | humanizePercentage }}) below 95% threshold"

      - alert: CriticalSuccessRate
        expr: (bofh_successful_swaps / bofh_total_swaps) < 0.90
        for: 2m
        labels:
          severity: critical
          component: reliability
        annotations:
          summary: "Critical swap success rate"
          description: "Success rate ({{ $value | humanizePercentage }}) below 90% threshold"

      # Price Impact Alerts
      - alert: HighPriceImpact
        expr: bofh_price_impact_percent > 5
        for: 1m
        labels:
          severity: warning
          component: price_impact
        annotations:
          summary: "High price impact detected"
          description: "Price impact ({{ $value }}%) exceeded 5% threshold"

      - alert: ExtremePriceImpact
        expr: bofh_price_impact_percent > 10
        for: 30s
        labels:
          severity: critical
          component: price_impact
        annotations:
          summary: "Extreme price impact detected"
          description: "Price impact ({{ $value }}%) exceeded critical 10% threshold"

      # Profitability Alerts
      - alert: UnprofitableSwaps
        expr: rate(bofh_failed_swaps[5m]) > rate(bofh_successful_swaps[5m]) * 0.1
        for: 3m
        labels:
          severity: warning
          component: profitability
        annotations:
          summary: "High rate of unprofitable swaps"
          description: "Unprofitable swap rate exceeding 10% of successful swaps"

      - alert: NegativeTotalProfit
        expr: bofh_total_profit_bnb < 0
        for: 10m
        labels:
          severity: critical
          component: profitability
        annotations:
          summary: "Negative total profit"
          description: "Total profit is negative ({{ $value }} BNB)"

      # Performance Alerts
      - alert: LowSwapThroughput
        expr: rate(bofh_total_swaps[5m]) < 0.01
        for: 10m
        labels:
          severity: info
          component: performance
        annotations:
          summary: "Low swap throughput"
          description: "Swap rate ({{ $value }} swaps/sec) below expected threshold"

      - alert: NoSwapsDetected
        expr: increase(bofh_total_swaps[15m]) == 0
        for: 15m
        labels:
          severity: warning
          component: availability
        annotations:
          summary: "No swaps detected"
          description: "No swap activity detected in the last 15 minutes"

      # MEV Protection Alerts
      - alert: MEVProtectionTriggered
        expr: increase(bofh_mev_protection_triggers[5m]) > 5
        for: 2m
        labels:
          severity: warning
          component: security
        annotations:
          summary: "MEV protection frequently triggered"
          description: "MEV protection triggered {{ $value }} times in last 5 minutes"

      # Contract State Alerts
      - alert: ContractPaused
        expr: bofh_contract_paused == 1
        for: 1m
        labels:
          severity: critical
          component: availability
        annotations:
          summary: "Contract is paused"
          description: "BofhContract is in paused state"

      - alert: RiskParamsChanged
        expr: changes(bofh_max_price_impact[10m]) > 0
        for: 1m
        labels:
          severity: info
          component: configuration
        annotations:
          summary: "Risk parameters changed"
          description: "Risk parameters have been modified"

      # Pool Health Alerts
      - alert: PoolBlacklisted
        expr: increase(bofh_pools_blacklisted[5m]) > 0
        for: 1m
        labels:
          severity: warning
          component: liquidity
        annotations:
          summary: "Pool blacklisted"
          description: "A liquidity pool has been blacklisted"

      - alert: HighPoolVolatility
        expr: bofh_avg_pool_volatility > 50
        for: 5m
        labels:
          severity: warning
          component: volatility
        annotations:
          summary: "High pool volatility detected"
          description: "Average pool volatility ({{ $value }}%) exceeds 50%"

# Alertmanager Configuration (alerts.yml companion file)
# This should be placed in your Alertmanager configuration directory
#
# Example alertmanager.yml configuration:
#
# global:
#   resolve_timeout: 5m
#
# route:
#   group_by: ['alertname', 'component']
#   group_wait: 10s
#   group_interval: 10s
#   repeat_interval: 1h
#   receiver: 'default'
#   routes:
#     - match:
#         severity: critical
#       receiver: 'critical-alerts'
#     - match:
#         severity: warning
#       receiver: 'warning-alerts'
#
# receivers:
#   - name: 'default'
#     webhook_configs:
#       - url: 'http://localhost:5001/'
#
#   - name: 'critical-alerts'
#     slack_configs:
#       - api_url: 'YOUR_SLACK_WEBHOOK_URL'
#         channel: '#critical-alerts'
#         title: 'üö® Critical Alert: {{ .GroupLabels.alertname }}'
#         text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
#
#   - name: 'warning-alerts'
#     slack_configs:
#       - api_url: 'YOUR_SLACK_WEBHOOK_URL'
#         channel: '#warnings'
#         title: '‚ö†Ô∏è Warning: {{ .GroupLabels.alertname }}'
#         text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
